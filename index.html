<!DOCTYPE html>  
<html lang="en">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>Login</title>  
    <link rel="stylesheet" href="style201.css">  

    <script type="module">  
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";  
        import { getDatabase, ref, get, child, push } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js";  

        const firebaseConfig = {  
          apiKey: "AIzaSyCgdTnXYep_-C6IqaGp1DUuB5gBTBGhx_0",  
          authDomain: "edvore-b11b7.firebaseapp.com",  
          databaseURL: "https://edvore-b11b7-default-rtdb.firebaseio.com/",  
          projectId: "edvore-b11b7",  
          storageBucket: "edvore-b11b7.appspot.com",  
          messagingSenderId: "239809584061",  
          appId: "1:239809584061:web:a20da5cfa66a347c0fd0d4"  
        };  

        const app = initializeApp(firebaseConfig);  
        const database = getDatabase(app);  

        document.addEventListener('DOMContentLoaded', () => {  
            const loginForm = document.getElementById('loginForm');  

            loginForm.addEventListener('submit', async (event) => {  
                event.preventDefault();  

                const username = document.getElementById('username').value.trim();  
                const password = document.getElementById('password').value.trim();  
                const rememberMe = document.getElementById('remember').checked;  

                if (!username || !password) {
                    alert("Enter username and password.");
                    return;
                }

                try {
                    const snapshot = await get(child(ref(database), 'users_control/' + username));
                    const user = snapshot.val();

                    if (!user) {
                        alert("Invalid username or password");
                        return;
                    }

                    if (user.active === false && username !== "Bless") {
                        alert("You havenâ€™t paid yet. Please contact the admin.");
                        return;
                    }

                    if (user.password === password) {
                        localStorage.setItem("username", username);
                        if (rememberMe) {
                            localStorage.setItem("rememberMe", "true");
                        } else {
                            localStorage.removeItem("rememberMe");
                        }
                        window.location.href = user.username + ".html";
                    } else {
                        alert("Invalid username or password");
                    }

                    await push(ref(database, 'loginAttempts'), {  
                        username: username,  
                        success: user.password === password,  
                        timestamp: Date.now()  
                    });

                } catch (err) {
                    alert("Error accessing Firebase: " + err);
                }
            });  

            const savedUsername = localStorage.getItem("username");  
            const rememberStatus = localStorage.getItem("rememberMe");  
            if (savedUsername && rememberStatus) {  
                document.getElementById("username").value = savedUsername;  
                document.getElementById("remember").checked = true;  
            }  

            const togglePassword = document.getElementById('togglePassword');
            const passwordInput = document.getElementById('password');

            // SVG icons
            const eyeSVG = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
                <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8z"/>
                <path d="M8 5.5a2.5 2.5 0 1 1 0 5 2.5 2.5 0 0 1 0-5z"/>
            </svg>`;
            const eyeSlashSVG = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
                <path d="M13.359 11.238C14.279 10.187 15 8.895 15 8s-3-5.5-8-5.5c-1.3 0-2.518.345-3.586.951L13.36 11.238z"/>
                <path d="M2.354 1.646a.5.5 0 0 1 .707 0l11 11a.5.5 0 0 1-.707.707l-11-11a.5.5 0 0 1 0-.707z"/>
            </svg>`;

            togglePassword.innerHTML = eyeSVG;

            togglePassword.addEventListener('click', () => {
                const type = passwordInput.type === 'password' ? 'text' : 'password';
                passwordInput.type = type;
                togglePassword.innerHTML = type === 'password' ? eyeSVG : eyeSlashSVG;
            });
        });  
    </script>  
</head>  
<body>  

<div class="login-container">  
    <div class="login-form">  
        <div class="logo">  
            <img src="logo.jpeg" alt="Logo" id="logo">  
            <img src="logo.png" alt="Logo" id="logo">  
        </div>  

        <form id="loginForm">  
            <div class="input-group">  
                <label for="username">Username</label>  
                <input type="text" id="username" name="username" required placeholder="Enter your username">  
            </div>  

            <div class="input-group" style="position:relative;">  
                <label for="password">Password</label>  
                <input type="password" id="password" name="password" required placeholder="Enter your password">  
                <span id="togglePassword" style="
                    position:absolute;
                    right:12px;
                    top:50%;
                    transform:translateY(-50%);
                    cursor:pointer;
                    color:#ccc;
                "></span>
            </div>  

            <div class="remember-group">  
                <label for="remember">  
                    <input type="checkbox" id="remember" name="remember"> Remember me  
                </label>  
            </div>  

            <div class="button-group">  
                <button type="submit" id="loginButton">Login</button>  
            </div>  
        </form>  
    </div>  
</div>  

</body>  
</html>