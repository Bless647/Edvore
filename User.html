<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>User Records</title>
<style>
    body {
        background-color: #121212;
        font-family: Arial, sans-serif;
        color: #ffffff;
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        padding-top: 20px;
        min-height: 100vh;
    }
    .container {
        width: 95%;
        max-width: 900px;
        background: rgba(0,0,0,0.7);
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    }
    h1 {
        text-align: center;
        margin-bottom: 20px;
    }
    .record {
        background-color: #1e1e1e;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 10px;
        display: flex;
        flex-direction: column;
        gap: 5px;
    }
    .record span {
        display: block;
        font-size: 1em;
    }
    .correct {
        color: #00ff00;
        font-weight: bold;
    }
    .incorrect {
        color: #ff4d4d;
        font-weight: bold;
    }
    .record button {
        margin-top: 5px;
        padding: 6px 12px;
        background-color: #ff4d4d;
        border: none;
        border-radius: 5px;
        color: white;
        cursor: pointer;
        align-self: flex-start;
        transition: 0.2s;
    }
    .record button:hover {
        background-color: #ff1a1a;
    }
    #backBtn {
        margin-top: 20px;
        padding: 12px 25px;
        background-color: #007bff;
        border: none;
        border-radius: 8px;
        color: white;
        font-size: 1em;
        cursor: pointer;
        transition: 0.3s;
    }
    #backBtn:hover {
        background-color: #0056b3;
        transform: scale(1.1);
    }
</style>
</head>
<body>
<div class="container">
    <h1>My Quiz Records</h1>
    <div id="records-container">
        <!-- Records will load here -->
    </div>
    <button id="backBtn" onclick="goBack()">Back to Subjects</button>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyCgdTnXYep_-C6IqaGp1DUuB5gBTBGhx_0",
        authDomain: "edvore-b11b7.firebaseapp.com",
        databaseURL: "https://edvore-b11b7-default-rtdb.firebaseio.com/",
        projectId: "edvore-b11b7",
        storageBucket: "edvore-b11b7.appspot.com",
        messagingSenderId: "239809584061",
        appId: "1:239809584061:web:a20da5cfa66a347c0fd0d4"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    const username = localStorage.getItem("username");
    const recordsContainer = document.getElementById("records-container");

    function goBack() {
        window.location.href = "subjects.html";
    }

    function formatTimestamp(timestamp) {
        const date = new Date(timestamp);
        return date.toLocaleString();
    }

    function loadRecords() {
        if (!username) {
            alert("No user logged in.");
            return;
        }
        recordsContainer.innerHTML = "<p>Loading your records...</p>";

        database.ref('Quiz_Submissions').orderByChild('username').equalTo(username).on('value', snapshot => {
            recordsContainer.innerHTML = "";
            if (!snapshot.exists()) {
                recordsContainer.innerHTML = "<p>No records found.</p>";
                return;
            }
            const data = snapshot.val();
            for (let key in data) {
                const record = data[key];
                const div = document.createElement("div");
                div.className = "record";

                const subject = document.createElement("span");
                subject.innerHTML = `<strong>Subject:</strong> ${record.subject || "N/A"}`;

                const timestamp = document.createElement("span");
                timestamp.innerHTML = `<strong>Time:</strong> ${formatTimestamp(record.timestamp)}`;

                const score = document.createElement("span");
                score.innerHTML = `<strong>Score:</strong> ${record.score}/${record.total}`;

                const answersList = document.createElement("div");
                for (let i = 0; i < record.answers.length; i++) {
                    const ansSpan = document.createElement("span");
                    const isCorrect = record.answers[i] === record.correctAnswers[i];
                    ansSpan.innerHTML = `<strong>Q${i+1}:</strong> ${record.questions[i]}<br>
                        Your answer: <span class="${isCorrect ? "correct" : "incorrect"}">${record.answers[i]}</span> | Correct: ${record.correctAnswers[i]}`;
                    answersList.appendChild(ansSpan);
                }

                const deleteBtn = document.createElement("button");
                deleteBtn.textContent = "Delete Record";
                deleteBtn.onclick = () => {
                    if (confirm("Are you sure you want to delete this record?")) {
                        database.ref('Quiz_Submissions/' + key).remove()
                        .then(() => {
                            div.remove();
                        }).catch(err => alert("Error deleting record: " + err));
                    }
                };

                div.appendChild(subject);
                div.appendChild(timestamp);
                div.appendChild(score);
                div.appendChild(answersList);
                div.appendChild(deleteBtn);
                recordsContainer.appendChild(div);
            }
        });
    }

    window.onload = loadRecords;
</script>
</body>
  </html>
