<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Maths Quiz</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f4f4f4; padding:20px; }
    .quiz-container { max-width:680px; margin:30px auto; background:#fff; padding:18px; border-radius:8px; box-shadow:0 4px 14px rgba(0,0,0,0.08); }
    h2 { margin:0 0 14px 0; font-size:20px; }
    .options button { display:block; width:100%; margin:8px 0; padding:10px; border:none; border-radius:6px; cursor:pointer; background:#007BFF; color:#fff; font-size:15px; text-align:left; }
    .options button:hover { background:#0062cc; }
    #result { margin-top:14px; font-weight:bold; min-height:1.2em; }
    #submitBtn { margin-top:14px; padding:10px 14px; background:#28a745; color:#fff; border:none; border-radius:6px; cursor:pointer; display:none; }
    #submitBtn:hover { background:#218838; }
    .meta { color:#666; font-size:13px; margin-bottom:8px; }
  </style>
</head>
<body>
  <div class="quiz-container">
    <div class="meta" id="userMeta">Logged in as: (not detected)</div>
    <h2 id="question">Question will appear here</h2>
    <div class="options">
      <button id="btnA" onclick="checkAnswer('a')">A) Option A</button>
      <button id="btnB" onclick="checkAnswer('b')">B) Option B</button>
      <button id="btnC" onclick="checkAnswer('c')">C) Option C</button>
    </div>
    <p id="result"></p>
    <button id="submitBtn" onclick="submitQuiz()">Submit Quiz</button>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCgdTnXYep_-C6IqaGp1DUuB5gBTBGhx_0",
      authDomain: "edvore-b11b7.firebaseapp.com",
      databaseURL: "https://edvore-b11b7-default-rtdb.firebaseio.com",
      projectId: "edvore-b11b7",
      storageBucket: "edvore-b11b7.appspot.com",
      messagingSenderId: "239809584061",
      appId: "1:239809584061:web:a20da5cfa66a347c0fd0d4"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
  </script>

  <script>
    const quiz = [
      { question: "1. What is the value of x in the equation 2x + 5 = 11?", a: "x = 2", b: "x = 3", c: "x = 5", correct: "b" },
      { question: "2. What is the sum of the interior angles of a triangle?", a: "360 degrees", b: "90 degrees", c: "180 degrees", correct: "c" },
      { question: "3. What is the formula for the area of a circle?", a: "A = πr²", b: "A = s²", c: "A = (b * h) / 2", correct: "a" },
      { question: "4. What is the value of 7² (7 squared)?", a: "49", b: "21", c: "42", correct: "a" },
      { question: "5. What is the sum of the numbers from 1 to 10?", a: "29", b: "21", c: "55", correct: "c" },
      { question: "6. What is the formula for the volume of a rectangular prism?", a: "V = L²H", b: "V = lwh", c: "A = πr²", correct: "b" },
      { question: "7. What is the value of x in the equation x / 4 = 9?", a: "x = 12", b: "x = 21", c: "x = 36", correct: "c" },
      { question: "8. What is the perimeter of a square with a side length of 5 cm?", a: "20 cm", b: "21 cm", c: "42 cm", correct: "a" },
      { question: "9. What is the value of 11² (11 squared)?", a: "66", b: "121", c: "42", correct: "b" },
      { question: "10. Find the product of 12 and 3", a: "36", b: "21", c: "42", correct: "a" }
    ];

    let current = 0;
    const userAnswers = new Array(quiz.length).fill(null);
    const questionEl = document.getElementById('question');
    const resultEl = document.getElementById('result');
    const userMeta = document.getElementById('userMeta');
    const submitBtn = document.getElementById('submitBtn');

    function loadQuestion() {
      const q = quiz[current];
      questionEl.textContent = q.question;
      document.getElementById('btnA').textContent = 'A) ' + q.a;
      document.getElementById('btnB').textContent = 'B) ' + q.b;
      document.getElementById('btnC').textContent = 'C) ' + q.c;
      resultEl.textContent = '';
      updateUserMeta();
    }

    function checkAnswer(choice) {
      userAnswers[current] = choice;
      const correct = quiz[current].correct;
      if (choice === correct) {
        resultEl.textContent = 'Correct!';
        resultEl.style.color = 'green';
      } else {
        resultEl.textContent = 'Wrong!';
        resultEl.style.color = 'red';
      }
      current++;
      if (current < quiz.length) {
        setTimeout(loadQuestion, 700);
      } else {
        setTimeout(finishQuiz, 700);
      }
    }

    function finishQuiz() {
      questionEl.textContent = 'Quiz Finished';
      resultEl.textContent = 'Press Submit to send your answers.';
      submitBtn.style.display = 'inline-block';
      document.querySelector('.options').style.pointerEvents = 'none';
    }

    function updateUserMeta() {
      const uname = localStorage.getItem('username');
      if (uname) userMeta.textContent = 'Logged in as: ' + uname;
      else userMeta.textContent = 'Logged in as: (not detected)';
    }

    function submitQuiz() {
      const username = localStorage.getItem('username');
      if (!username) {
        alert('You must be logged in to submit. Redirecting to login page.');
        window.location.href = 'login.html';
        return;
      }
      let score = 0;
      for (let i = 0; i < quiz.length; i++) {
        if (userAnswers[i] === quiz[i].correct) score++;
      }
      const payload = {
        username: username,
        subject: 'Maths',
        answers: userAnswers,
        score: score,
        timestamp: Date.now()
      };
      const key = 'Maths_Submission/' + Date.now();
      firebase.database().ref(key).set(payload)
        .then(() => {
          alert('Quiz submitted. Thanks, ' + username + '! Score: ' + score + '/' + quiz.length);
          window.location.href = 'Subjects.html';
        })
        .catch(err => {
          alert('Error submitting quiz: ' + err);
        });
    }

    window.onload = function() {
      updateUserMeta();
      loadQuestion();
    };
  </script>
</body>
  </html>
